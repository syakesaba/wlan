/*
Graphviz - DOT language writing!
$dot -Tsvg this.dot -o this.svg
*/
digraph Diagram {
    //PROFILE [label = "written by SYA-KE", shape=none];
    nodesep=0.1;
    node [fontsize=10];
    edge [fontsize=9];
    subgraph clusterOPN{
        label = "OPN";
        subgraph OPN_N_If {
            node [shape=diamond]
            NothingToDo;
        }
        subgraph OPN_Flow {
        }
    }
    subgraph clusterWEP {
        label = "WEP";
        subgraph WEP_N_If {
            node [shape=diamond]
            HasClient_WEP [label="HasClient"];
        }
        subgraph WEP_Flow {
        }
    }
    subgraph clusterWPA {
        label = "WPA";
        subgraph WPA_N_If {
            node [shape=diamond]
            IsTKIP;
            IsPSK;
        }
        subgraph WPA_Flow {
            IsTKIP -> HasAP_PSK [label="Yes."];
            IsTKIP -> IsPSK [label="No."];
            //IsTKIP -> KobeCrack [label="gain xor -> sniff and forge packets(do XOR each transaction)"]
            IsPSK -> HasClient_PSK [label="Yes."];
            IsPSK -> HasClient_EAP [label="NO."];
        }
        subgraph clusterPSK {
            label = "PSK";
            subgraph PSK_N_If {
                HasClient_PSK [label="HasClient"];
                HasAP_PSK [label="HasAP"];
                HasAP_WPS_PSK [label="DoesAccessPointUseWPS"];
            }
            subgraph PSK_N_Flow {
                HasAP_PSK -> HasAP_WPS_PSK [label="Yes"];
                //HasAP_PSK -> HasClient_PSK [label="Yes"];
                //HasClient_PSK -> HasAP_PSK [label="Yes."];
                //HasClient_PSK -> HasAP_PSK [label="No."]
            }
        }
        subgraph clusterEAP {
            label = "EAP";
            HasClient_EAP [label="HasClient"];
        }
    }
    subgraph clusterMain {
        label = "Connecting Wireless-LAN Access Point";
        subgraph N_Start {
            node [shape=invtriangle];
            Start;
        }
        subgraph N_End {
            node [shape=triangle];
            End;
        }
        subgraph Nodes {
            subgraph N_Do {
                node [shape=box];
                ImproveYourWifiAntenna [URL="http://www.instructables.com/id/DIY-WIFI-Antenna-Reception-Booster/"];
                DeauthAllClient [URL="http://www.aircrack-ng.org/doku.php?id=deauthentication"];
                SpoofHardwareAddress [URL="http://www.securethelock.com/2013/12/03/how-to-bypass-mac-address-filtering-using-backtrackkali-linux/"]
            }
            subgraph N_If {
                node [shape=diamond];
                HasAccessPointsAroundYou [URL="http://www.aircrack-ng.org/doku.php?id=airodump-ng"];
                IsStealthESSID [URL="http://securitysynapse.blogspot.jp/2014/01/wireless-pentesting-on-cheap-kali-hiddenSSID.html"];
                IsThereConnectedClient [URL="http://blackhat6969.blogspot.jp/2012/09/down-and-dirty-wifi-cracking-with.html"];
                HasHardwareAddressFiltering [URL="http://synjunkie.blogspot.jp/2007/12/bypass-hidden-ssid-mac-address-filter.html"];
                HasEncryption [URL="http://www.dummies.com/how-to/content/wireless-security-protocols-wep-wpa-and-wpa2.html"];
                HasWebAuthentication [URL="http://www.slideshare.net/support_cyberoam/hotspot-authentication"];
                IsWEP [URL="http://www.howtogeek.com/167783/htg-explains-the-difference-between-wep-wpa-and-wpa2-wireless-encryption-and-why-it-matters/"];
            }
        }
        subgraph Flow {
            Start -> HasAccessPointsAroundYou;
            {HasAccessPointsAroundYou ImproveYourWifiAntenna} -> IsStealthESSID [label="I have."];
            HasAccessPointsAroundYou -> ImproveYourWifiAntenna [label="Seems nothing."];
            IsStealthESSID -> IsThereConnectedClient [label="I don't know ESSID."];
            IsThereConnectedClient -> DeauthAllClient [label="Yes. Someone connects."];
            IsThereConnectedClient -> IsThereConnectedClient [label="No."];
            {IsStealthESSID DeauthAllClient } -> HasHardwareAddressFiltering [label="I got ESSID from frames."]
            HasHardwareAddressFiltering -> SpoofHardwareAddress [label="Yes, I can't associate with AP."]
            {HasHardwareAddressFiltering SpoofHardwareAddress} -> HasEncryption [label="I could associate with AP(or WEP-SKA)."]

            HasEncryption -> NothingToDo [label="No. It's OPN access."]
            //goto clusterOPN

            HasEncryption -> IsWEP [label="It has."];
            IsWEP -> HasClient_WEP [label="Yes. WEP."];
            //goto clusterWEP

            IsWEP -> IsTKIP [label="No.WPA."];
            //goto clusterWPA

            //backfrom OPN/WEP/WPA
            NothingToDo -> HasWebAuthentication;
        }
    }
    subgraph clusterCommands {
        label = "CommandsAndNotes";
        subgraph Nt_Command {
            node [shape=box];
            HasAccessPointsAroundYouCommand [label="ifconfig wlan0 down;\niwconfig wlan0 mode mon || airmon-ng start wlan0;\nairodump-ng wlan0;\n"];
            ImproveYourWifiAntennaCommand [label="iw reg set BO;\niwconfig wlan0 tx 30;\n#Add DIY Parabora."];
            IsStealthESSIDCommand [label="airodump-ng -c [channel] --bssid [AP MAC] wlan0"]
            DeauthAllClientCommand [label="aireplay-ng -0 0 -a [AP MAC] wlan0;\naireplay-ng -0 0 -a [AP MAC] -c [STA MAC] wlan0;"];
        }
        subgraph Nt_Flow {
            edge [color=gray];
            HasAccessPointsAroundYouCommand -> HasAccessPointsAroundYou;
            ImproveYourWifiAntennaCommand -> ImproveYourWifiAntenna;
            IsStealthESSIDCommand -> IsStealthESSID;
            DeauthAllClientCommand -> DeauthAllClient;
        }
    }
}
        //subgraph clusterFlow {
        /*
        subgraph Flow {
            IcapRequest -> IsREQMOD [label="ICAP Request From Proxy"];
            {IsREQMOD -> IsRESPMOD [label="no"]} -> IsHTTP [label="yes"];

            IsHTTP -> IsHTTPResponse [label="yes"];

            IsHTTPResponse -> IsHTTPRequest [label="no"];
            IsHTTPResponse -> HasCanariaCookie [label="yes"];
            HasCanariaCookie -> SetCanariaCookie [label="no"];
            HasCanariaCookie -> 204 [label="yes"];
            SetCanariaCookie -> 200 [label="mod please"];

            IsHTTPRequest -> CheckURL_ModSecurity_Canaria [label="yes"];
            {CheckURL_ModSecurity_Canaria -> CheckBody_ModSecurity_Canaria [label="OK"]} -> 403 [label="XSS!"];
            CheckBody_ModSecurity_Canaria -> 204 [label="OK"];

            {IsRESPMOD IsHTTP IsHTTPRequest} -> 204 [label="Exception"];//OPTIONS, etc..
            {rank=same; 200 204 403} -> IcapResponse [label="ICAP Response to Proxy"];//同じ階層に
        }
        //{edge[style=invis];
            //{IcapRequest} -> {IcapResponse};
        //}
        */

